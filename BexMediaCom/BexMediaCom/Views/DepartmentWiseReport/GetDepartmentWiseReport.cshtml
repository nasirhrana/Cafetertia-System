@{
    ViewBag.Title = "DeptTransactionView";
    Layout = "~/Views/Shared/_ViewDepartmentTransaction.cshtml";
}
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/dt-1.10.18/datatables.min.css" />
<link rel="stylesheet" type="text/css" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" />
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/dataTables.jqueryui.min.css" />
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/1.5.2/css/buttons.jqueryui.min.css" />
<link href="~/Content/plugins/StyleSheet1.css" rel="stylesheet" />
<!-- Content Wrapper. Contains page content -->
<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
        <h1>
            Division Wise Total Report
            <small>Division Wise Total Report</small>
        </h1>
    </section>
    <!-----------------------------------------------------------------------------------Common &  Menu Section------------------------------------------------------------------------------->
    <!-- Main content -->
    <section class="content">
        <div class="row">
            <!-- right column -->
            <div class="col-md-12">
                <div class="box-size box-danger">
                    <div class="box-header with-border">
                        <h3 class="box-title">Division Wise Total Report</h3>
                    </div>
                    <form class="form-horizontal" method="POST" id="myForm">
                        <div class="box-body">
                            <div class="col-md-4">
                                <div class="row">
                                    <!-- Date range -->
                                    <div class="form-group">

                                        <div class="col-sm-11">
                                            <label for="DivisionId" class="control-label">Division</label>
                                            <select class="form-control select2" id="Name" name="DivisionId" style="width: 100%;">
                                                <option disabled selected>Select One</option>
                                            </select>
                                        </div>
                                    </div><!-- /.form-group -->
                                    <!-- /.form group -->
                                </div>
                            </div>
                            @*<div class="col-md-3">
                                <div class="row">
                                    <div class="form-group">
                                        <label for="Name" class="col-sm-2 control-label">Department</label>
                                        <div class="col-sm-11">
                                            <select class="form-control select2" id="Name" name="Name" style="width: 100%;">
                                                <option value="0">Select One</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>*@

                            <div class="col-md-4">
                                <div class="row">
                                    <!-- Date range -->
                                    <div class="form-group">
                                        <label for="Name" class="col-sm-2 control-label">Date</label>
                                        <div class="col-sm-11">
                                            <div class="input-group">
                                                <div class="input-group-addon">
                                                    <i class="fa fa-calendar"></i>
                                                </div>
                                                <input type="text" name="daterange" class="form-control pull-right" id="reservation">
                                            </div>
                                            <!-- /.input group -->
                                        </div>
                                    </div>
                                    <!-- /.form group -->
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="row">
                                    <div class="form-group">
                                        <label for="Name" class="col-sm-2 control-label">Item</label>
                                        <div class="col-sm-5">
                                            <input type="checkbox" id="Breakfast" name="Breakfast" value="8"> Breakfast<br>
                                            <input type="checkbox" id="Lunch" name="Lunch" value="6"> Lunch<br>
                                            <input type="checkbox" id="Dinner" name="Dinner" value="7"> Dinner
                                        </div>
                                        <div class="col-sm-5">
                                            <input type="checkbox" id="Sehuri" name="Sehuri" value="9"> Sehri <br />
                                            <input type="checkbox" id="All" name="All" value="999999"> All
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                    <!-- /.box-body -->
                    <div class="box-footer">
                        <button type="button" class="btn btn-default" onclick="funClear();">Cancel</button>
                        <button type="submit" id="Generate" class="btn btn-info pull-right">Generate</button>
                    </div><!-- /.box-footer -->
                </div><!-- /.box -->
            </div>
            <!-- /.col -->
        </div><!-- /.row -->
        <!-- Data Table-------------------------------------------------------------------------------------------------------------------------------------------- -->
        <div class="row">
            <div class="col-md-12">
                <div class="box-size">
                    <div class="box-header">
                        <h3 class="box-title">Department Daily Transaction</h3>
                    </div>
                    <!-- /.box-header -->
                    <div class="box-body">
                        <table id="myTable" class="table table-bordered table-striped" style="text-align: center">
                            <thead>
                                <tr>
                                    <th style="text-align: center"> SL.</th>
                                    <th style="text-align: center"> Department</th> 
                                    <th style="text-align: center"> AVG. Meal Cost</th>
                                    <th style="text-align: center"> Total Meal</th>
                                    <th style="text-align: center">Total Taka</th>
                                </tr>
                            </thead>
                            <tbody id="departmentWishReport"></tbody>
                            <tfoot>
                                <tr>

                                    <td colspan='1'> <span style="text-align: center; color: black" id='totalSalary1'>  </span> </td>
                                    <td colspan='1'> <span style="text-align: center; color: black; " id='totalSalary2'>   </span> </td>
                                    <td colspan='1'> <span style="text-align: center; color: black; " id='totalSalary3'> </span> </td>
                                    <td colspan='1'> <span style="text-align: center; color: black; " id='totalSalary4'>  </span> </td>
                                    <td colspan='1'> <span style="text-align: center; color: black; " id='totalSalary5'>  </span> </td>

                                </tr>

                            </tfoot>
                        </table>
                    </div>
                    <!-- /.box-body -->
                </div>
                <!-- /.box -->
            </div>
        </div>
    </section><!-- /.content -->
</div><!-- /.content-wrapper -->
@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")

    <script src="~/Content/plugins/InputMask/jquery.inputmask.bundle.min.js"></script>

    <script src="~/JavaScript/JavaScript8.js"></script>
    <script src="~/JavaScript/JavaScript9.js"></script>
    <script src="~/JavaScript/JavaScript10.js"></script>
    <script src="~/JavaScript/JavaScript11.js"></script>
    <script src="~/JavaScript/JavaScript12.js"></script>
    <script src="~/JavaScript/JavaScript1.js"></script>
    <script src="~/JavaScript/JavaScript2.js"></script>
    <script src="~/JavaScript/JavaScript3.js"></script>
    <script src="~/JavaScript/JavaScript4.js"></script>
    <script src="~/JavaScript/JavaScript5.js"></script>
    <script>
    $(document).ready(function () {

        $("#Generate").click(function () {
            $('#myTable').DataTable().destroy();
            var name = $("#Name").val();
            var date = $("#reservation").val();
            var breakfast = $("#Breakfast").is(':checked') ? 8 : 0;
            var lunch = $("#Lunch").is(':checked') ? 6 : 0;
            var dinner = $("#Dinner").is(':checked') ? 7 : 0;
            var sehuri = $("#Sehuri").is(':checked') ? 9 : 0;
            var all = $("#All").is(':checked') ? "All" : 0;
            var index = date.indexOf('-');
            var startdate = date.substring(0, index);
            var enddate = date.substring(index + 1);

            $.ajax({
                url: '@Url.Action("DepartmentReport", "DepartmentWiseReport")',
                dataType: 'json',
                method: 'post',
                data: { name: name, startdate: startdate, enddate: enddate, breakfast: breakfast, lunch: lunch, dinner: dinner, sehuri: sehuri, all: all },
                success: function (data) {
                    if (data.length != 0) {
                        $('#myTable').dataTable({
                            destroy: true,
                            dom: 'Bfrtip',
                            "footerCallback": function (tfoot, data, start, end, display) {
                                var api = this.api();
                                var p = api.column(4).data().reduce(function (a, b) {
                                    return a + b;
                                }, 0);

                                //var p1 = api.column(3).data().reduce(function (a, b) {
                                //    return a + b;
                                //}, 0);

                                var p2 = api.column(3).data().reduce(function (a, b) {
                                    return a + b;
                                }, 0);
                                $('#totalSalary1').html("Total");
                                $('#totalSalary4').html(p2);
                                //$('#totalSalary4').html(p1);
                                $('#totalSalary5').html(p.toFixed(2));
                            },
                            buttons: [
                             {
                                 extend: 'excel',
                                 title: 'Division Wise Cafeteria Bill',
                                 footer: true
                             },

                             {
                                 extend: 'pdfHtml5',
                                 title: 'Export',
                                 header: true,
                                 messageTop: 'Division : ' + data[0].Division,
                                 messageBottom: '@DateTime.Now',
                                 customize: function (doc) {
                                     doc.content[2].margin = [100, 5, 100, 20],
                                     doc.content.splice(0, 1, {
                                         text: [
                                             {
                                                 text: 'Division Wise Cafeteria Bill \n',
                                                 bold: true,
                                                 fontSize: 16
                                             },
                                         {
                                             text: 'Form : ' + startdate + 'To : ' + enddate +' \n',
                                             bold: true,
                                             fontSize: 11
                                         }

                                         ],
                                         margin: [0, 0, 0, 12],
                                         alignment: 'center',

                                     });
                                 }
                             },

                             {
                                 extend: 'print',
                                 title: 'Division Wise Cafeteria Bill' + '<br/>' + 'Form : ' + startdate + 'To : ' + enddate,
                                  messageTop: 'Division : ' + data[0].Division,
                                  messageBottom: '@DateTime.Now',
                                 footer: true,
                                 header: true,
                                 customize: function ( win ) {
                                     $(win.document.body).find('h1').css('text-align', 'center');
                                     $(win.document.body).find('h1').css('font-size', '17px');
                                     $(win.document.body).find('td').css('text-align', 'center');
                                     $(win.document.body).find('th').css('text-align', 'center');
                                     $(win.document.body).css( 'font-size', '12px' );
                                     $(win.document.body).find( 'table' )
                                     .addClass( 'compact' )
                                     .css( 'font-size', 'inherit' );
                                 }
                             },

                              {
                                  extend: 'print',
                                  text: 'Preview',
                                  title: 'Division Wise Cafeteria Bill' + '<br/>' + 'Form : ' + startdate + 'To : ' + enddate,
                                  messageTop: 'Division : ' + data[0].Division,
                                  messageBottom: '@DateTime.Now',
                                  footer: true,
                                  header: true,
                                  autoPrint: false,
                                  customize: function (win) {
                                      $(win.document.body).find('h1').css('text-align', 'center');
                                      $(win.document.body).find('h1').css('font-size', '17px');
                                      $(win.document.body).find('td').css('text-align', 'center');
                                      $(win.document.body).find('th').css('text-align', 'center');
                                      $(win.document.body).css('font-size', '12px');
                                      $(win.document.body).find('table')
                                      .addClass('compact')
                                      .css('font-size', 'inherit');
                                  }
                              }
                            ],
                            data: data,
                            columns: [
                                { 'data': 'SerialNumber' },
                                { 'data': 'Department' },
                                { 'data': 'ItemCost' },
                                { 'data': 'ItemQty' },
                                { 'data': 'Total' }

                            ],
                            order: [1, 'asc'],
                            //rowGroup: {
                            //    dataSrc: 'EmployeeName'
                            //}
                        });
                    } else {
                        $('#myTable').DataTable().clear().destroy();
                        var table = $('#myTable').DataTable({
                            "footerCallback": function (tfoot, data, start, end, display) {
                                var api = this.api();


                                //$('#totalSalary4').html("Total : " + p);
                                $('#totalSalary1').html("Total");
                                $('#totalSalary4').html(0);
                                $('#totalSalary5').html(0.00);
                            },
                        });
                        table.clean();
                    }


                }
            });

        });

        $(function () {
            $('input[name="daterange"]').daterangepicker({
                opens: 'left'
            }, function (start, end, label) {
                console.log("A new date selection was made: " + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD'));
            });
        });


        getDivision();
        $("#DivisionId").change(function () {
            $('#Name').find('option')
                .remove()
                .end()
                .append('<option disabled selected>Select One</option>');
            var divisionId = $("#DivisionId").val();
            var json = { divisionId: divisionId, };
            $.ajax({
                type: "POST",
                url: '@Url.Action("GetAllDepartmentByDivisionId", "Employee")',
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify(json),
                success: function (data) {
                    $.each(data, function (index, value) {
                        $('#Name').append('<option value="' + value.Id + '">' + value.Name + '</option>');
                    });
                }
            });

        });

    });
    function getDivision() {
        //$('#DivisionId').find('option')
        //    .remove()
        //    .end()
        //    .append('<option disabled selected>Select One</option>');
        $.ajax({
            url: "../Employee/GetAllDivision",
            type: "POST",
            success: function (result) {

                $.each(result, function (index, value) {
                    $('#Name').append('<option value="' + value.Id + '">' + value.Name + '</option>');
                });
            },
            error: function (err) {
                alert(err);
            }
        });
    }
    </script>

}